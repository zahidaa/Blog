<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="en">
    <meta name="author" content="Waseem Akram">
    <meta name="description" content="">
    <meta name="keywords" content="Researcher, Pentest, dev">
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Posts" />
    <meta name="twitter:description" content="" />
    <meta property="og:title" content="Posts" />
    <meta property="og:description" content="" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="/posts/" />
    <title>Apk decompilers - Waseem Akram</title>
    <link rel="canonical" href="/posts.html">
    <link rel="preload" href="/fonts/forkawesome-webfont.woff2v=1.1.7" as="font" type="font/woff2" crossorigin>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/normalize.css" />
    <link rel="manifest" href="/js/manifest.json">
    <link rel="icon" type="image/png" href="/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="/images/favicon-16x16.png" sizes="16x16">
    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
    <link href='https://unpkg.com/boxicons@2.1.2/css/boxicons.min.css' rel='stylesheet'>
    <link rel="alternate" type="application/rss+xml" href="../posts/index.xml" title="Waseem Akram" />
    <script defer src="https://twemoji.maxcdn.com/v/13.0.1/twemoji.min.js"></script>
    <!-- google Ads -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9670252621494000"
        crossorigin="anonymous"></script>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-0PCVFG8BNK"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());

        gtag('config', 'G-0PCVFG8BNK');
    </script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9670252621494000"
        crossorigin="anonymous"></script>
    <!-- hackerwasii -->
    <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-9670252621494000" data-ad-slot="1081579313"
        data-ad-format="auto" data-full-width-responsive="true"></ins>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script><!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-0PCVFG8BNK"></script>
    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());

        gtag('config', 'G-0PCVFG8BNK');
    </script>
</head>

<body class="colorscheme-auto" onload=" twemoji.parse(document.body); ">
    <div class="float-container">
        <a id="dark-mode-toggle" class="colorscheme-toggle">
            <i class='bx bx-adjust'></i>
        </a>
    </div>
    <main class="wrapper">
        <nav class="navigation">
            <section class="container">
                <a class="navigation-title" href="/">Waseem Akram</a>
                <input type="checkbox" id="menu-toggle" />
                <label class="menu-button float-right" for="menu-toggle">
                    <i class='bx bx-menu'></i>
                </label>
                <ul class="navigation-list">
                    <li class="navigation-item">
                        <a class="navigation-link" href="/whoami">🔎 About</a>
                    </li>

                    <li class="navigation-item">
                        <a class="navigation-link" href="/posts/resources">🎉 Resources</a>
                    </li>

                    <li class="navigation-item">
                        <a class="navigation-link" href="/blog">📚 Blog</a>
                    </li>
                </ul>
            </section>
        </nav>
        <div class="content">
            <section class="container post">
                <article>
                    <header>
                        <div class="post-title">
                            <h1 class="title">
                                <a class="title-link" href="/posts/android/apk-decompilers">
                                    APK Decompilers
                                </a>
                            </h1>
                        </div>
                        <div class="post-meta">
                            <div class="date">
                                <span class="posted-on">
                                    <i class='bx bxs-calendar'></i>
                                    <time datetime='2022-07-25T12:06:55&#43;01:00'>
                                        August 2 , 2022
                                    </time>
                                </span>
                                <span class="reading-time">
                                    <i class='bx bx-time-five'></i>
                                    2-minute read
                                </span>
                            </div>
                            <div class="categories">
                                <i class='bx bxs-folder'></i>
                                <a href="/categories/categories">hacking</a>
                                <span class="separator">•</span>
                                <a href="/categories/categories">android</a>
                            </div>
                            <div class="tags">
                                <i class='bx bxs-purchase-tag'></i>
                                <span class="tag">
                                    <a href="/tags/tags">reverse engineering</a>
                                </span>
                            </div>
                            <h2><strong>Table of Contents</strong></h2>
                            <aside class="table-of-contents">
                                <nav id="TableOfContents">
                                    <ul>
                                        <li><a href="#jd-gui">JD-Gui</a></li>
                                        <li><a href="#jadx">Jadx</a>
                                            <ul>
                                                <li><a href="#jadx-opt">Some interesting options of jadx</a></li>
                                            </ul>
                                        </li>
                                        <li><a href="#gda-tool">GDA-Android-reversing-Tool</a></li>
                                        <li><a href="#bytecode">Bytecode-Viewer</a></li>
                                        <li><a href="#Enjarify">Enjarify</a></li>
                                        <li><a href="#cfr">CFR</a></li>
                                        <li><a href="#fernflower">Fernflower</a></li>
                                        <li><a href="krakatu">Krakatu</a></li>
                                        <li><a href="#procyon">procyon</a></li>
                                    </ul>
                                </nav>
                            </aside>
                            <h2 id="jd-gui"><strong>JD-Gui</strong></h2>
                            <p>
                                First famous gui Java decompiler, you could use it to investigate the Java code from the
                                APK once you have obtained it.
                            </p>
                            <hr>
                            <h2 id="jadx"><strong>Jadx</strong></h2>
                            <p>
                                Buildin Java (multi-platform)and at this moment I think it's the recommended one.
                                Just <strong>download</strong> the <strong>latest</strong> version and execute it from
                                the <strong style="font-style: italic;">bin</strong> folder:
                                <div class="highlight">
                                    <pre tabindex="0"
                                        style="color:#e5e5e5;background-color:#424242;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">jadx-gui</code></pre>
                                </div>
                                Using the GUI you can perform <strong>text search</strong>, go to the <strong>functions
                                    definitions</strong> (<span style="font-style: italic;"><strong>CTRL + left
                                        click</strong></span> on the function) and cross refs (<span
                                    style="font-style: italic;"><strong>right click --> Find Usage</strong></span>)
                                <p>
                                    If you <strong>only want</strong> the <strong>java code</strong> but without using a
                                    GUI a very easy way is to use the jadx cli tool:
                                </p>
                                <div class="highlight">
                                    <pre tabindex="0"
                                        style="color:#e5e5e5;background-color:#424242;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">jadx app.apk</code></pre>
                                </div>
                                <h2 id="jadx-opt"><strong>Some interesting options of jadx (GUI and CLI versions)
                                        are:</strong></h2>
                                <div class="highlight">
                                    <pre tabindex="0"
                                        style="color:#e5e5e5;background-color:#424242;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">-d &lt;path to output dir&gt; <br>--no-res #No resources <br>--no-src #No source code <br>--no-imports #Always write entire package name (very useful to know where is the function that you might want to hook)</code></pre>
                                </div>
                            </p>
                            <hr>
                            <h2 id="gda-tool">GDA-Android-reversing-Tool</h2>
                            <p>
                                GDA is also a powerful and fast reverse analysis platform. Which does not only supports
                                the basic decompiling operation, but also many excellent functions like
                                <strong>Malicious
                                    behavior detection, Privacy leaking detection, Vulnerability detection, Path
                                    solving,
                                    Packer identification, Variable tracking analysis, Deobfuscation, Python& Java
                                    scripts,
                                    Device memory extraction, Data decryption and encryption</strong> etc**.**
                            </p>
                            <p>
                                <strong>Only for Windows.</strong>
                                <p>
                                    <img src="/images/gda-android-rev.png" alt="GDA-Android-reversing-Tool"
                                        class="post__img">
                                </p>
                            </p>
                            <hr>
                            <h2 id="bytecode"><strong>Bytecode-Viewer</strong></h2>
                            <p>
                                Another <strong>interesting tool to make a Static analysis is</strong>: <a
                                    href="https://github.com/Konloch/bytecode-viewer/releases" target="_blank"
                                    style="text-decoration: none;">bytecode-viewer</a>. It allows you to
                                decompile the APK using <strong>several decompilers at the same time.</strong> Then, you
                                can see for
                                example, 2 different Java decompilers and one Smali decompiler. It allows you also to
                                <strong>modify</strong> the code:
                                <p>
                                    <img class="post__img" src="/images/bytecode-viewer.png" alt="bytecode-viewer">
                                </p>
                                If you modify the code, then you can <strong>export it.</strong>
                                <p>
                                    One bad thing of bytecode-viewer is that it <strong>doesn't have references</strong>
                                    or <strong>cross-references.</strong>
                                </p>
                            </p>
                            <hr>
                            <h2 id="Enjarify"><strong>Enjarify</strong></h2>
                            <p>
                                Enjarify is a tool for translating Dalvik bytecode to equivalent Java bytecode. This
                                allows Java analysis tools to analyze Android applications.
                                Dex2jar is an older tool that also tries to translate Dalvik to Java bytecode. It works
                                reasonably well most of the time, but a lot of obscure features or edge cases will cause
                                it to fail or even silently produce incorrect results. By contrast, Enjarify is designed
                                to work in as many cases as possible, even for code where Dex2jar would fail. Among
                                other things, Enjarify correctly handles unicode class names, constants used as multiple
                                types, implicit casts, exception handlers jumping into normal control flow, classes that
                                reference too many constants, very long methods, exception handlers after a catchall
                                handler, and static initial values of the wrong type.
                            </p>
                            <hr>
                            <h2 id="cfr"><strong>CFR</strong></h2>
                            <p>
                                CFR will decompile modern Java features - <a
                                    href="https://www.benf.org/other/cfr/java9observations.html" target="_blank"
                                    style="text-decoration: none;">including much of Java</a> <a
                                    href="https://github.com/leibnitz27/cfr/blob/master/java9stringconcat.html"
                                    target="_blank" style="text-decoration: none;">9</a>, <a
                                    href="https://www.benf.org/other/cfr/switch_expressions.html" target="_blank"
                                    style="text-decoration: none;">12</a> & <a
                                    href="https://www.benf.org/other/cfr/java14instanceof_pattern" target="_blank"
                                    style="text-decoration: none;">14</a>, but is
                                written entirely in Java 6, so will work anywhere! (<a
                                    href="https://www.benf.org/other/cfr/faq.html" target="_blank"
                                    style="text-decoration: none;">FAQ</a>) - It'll even make a decent go
                                of turning class files from other JVM languages back into java!
                                <p>That JAR file can be used as follows:</p>
                                <div class="highlight">
                                    <pre tabindex="0"
                                        style="color:#e5e5e5;background-color:#424242;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">java -jar ./cfr.jar "$JARFILE" --outputdir "$OUTDIR"</code></pre>
                                </div>
                                <p>
                                    For larger JAR files I found it to run out of memory. You can simply adapt the size
                                    of the memory allocation pool of the JVM if that happens to you, too.
                                </p>
                                <div class="highlight">
                                    <pre tabindex="0"
                                        style="color:#e5e5e5;background-color:#424242;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">java -Xmx4G -jar ./cfr.jar "$JARFILE" --outputdir "$OUTDIR"</code></pre>
                                </div>
                                This example will allow a maximum of 4GB to be allocated.
                                <p>
                                    In the output directory, you will find the decompiled
                                    <code><strong>.java</strong></code> files, together with a summary of the
                                    decompilation
                                </p>
                            </p>
                            <hr>
                            <h2 id="fernflower"><strong>Fernflower</strong></h2>
                            <p>
                                Next up is <a
                                    href="https://github.com/JetBrains/intellij-community/tree/master/plugins/java-decompiler/engine"
                                    target="_blank" style="text-decoration: none;">Fernflower</a>, which is part of <a
                                    href="https://www.jetbrains.com/idea/" target="_blank"
                                    style="text-decoration: none;">IntelliJ IDEA</a>. Everyone mentions that it is an
                                analytical decompiler (as stated in their project description), but nobody points out
                                what this actually means. I only found <a href="https://stackoverflow.com/q/62298929"
                                    target="_blank" style="text-decoration: none;">this Stackoverflow question</a>,
                                which unfortunately
                                remains unanswered as of today.
                                <p>
                                    Anyway, since there are no self-contained releases, you need to build it yourself.
                                    As a <a href="https://gradle.org/" target="_blank"
                                        style="text-decoration: none;">Gradle</a>-based project, you can clone it and
                                    then run the following command given
                                    that Gradle is installed on your machine.
                                    <div class="highlight">
                                        <pre tabindex="0"
                                            style="color:#e5e5e5;background-color:#424242;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">cd ./plugins/java-decompiler/engine && gradle jar</code></pre>
                                    </div>
                                    Here, we first switch our working directory to the root directory of Fernflower.
                                    Then, we instruct Gradle to build the file <code>./build/libs/fernflower.jar</code>.
                                    <p>The invocation of Fernflower is similar to that of CFR.</p>
                                    <div class="highlight">
                                        <pre tabindex="0"
                                            style="color:#e5e5e5;background-color:#424242;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">java -jar ./fernflower.jar "$JARFILE" "$OUTDIR"</code></pre>
                                    </div>
                                    Among the decompilers described here, this is the only one that outputs the
                                    generated <code>.java</code> files in a JAR file. You can easily extract the source
                                    files using <code>unzip</code>.
                                </p>
                            </p>
                            <hr>
                            <h2 id="krakatu"><strong>Krakatu</strong></h2>
                            <p>
                                Remember Enjarify from above? The very same author is also the developer of a decompiler
                                named <a href="https://github.com/Storyyeller/Krakatau" target="_blank"
                                    style="text-decoration: none;">Krakatau.</a>
                                <p>
                                    In contrast to the other projects, this one is written in Python. And I think this
                                    is the reason why it’s a bit different from the others.
                                </p>
                                <p>
                                    And according to the description, these standard library classes come with up to
                                    version 8 of Java in the form of the file <code>rt.jar</code>. For later versions,
                                    the author
                                    provides <a href="https://github.com/Storyyeller/jrt-extractor" target="_blank"
                                        style="text-decoration: none;">jrt-extractor</a>, which can generate this file
                                    for us.
                                    <p>So we download that tool and run the following commands.</p>
                                    <div class="highlight">
                                        <pre tabindex="0"
                                            style="color:#e5e5e5;background-color:#424242;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">cd ./jrt-extractor <br>javac JRTExtractor.java <br>java -ea JRTExtractor</code></pre>
                                    </div>
                                    This should have written a file <code>rt.jar</code> inside the directory.
                                </p>
                                Given this file, we can run Krakatau as follows.
                                <div class="highlight">
                                    <pre tabindex="0"
                                        style="color:#e5e5e5;background-color:#424242;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">./Krakatau/decompile.py -out "$OUTDIR" -skip -nauto -path ./jrt-extractor/rt.jar "$JARFILE"</code></pre>
                                </div>
                                Let me refer to the project’s GitHub for an explanation of the parameters. Just note
                                that for any libraries used by your JAR file, Krakatau will require you to add it as a
                                JAR file to the <code>-path</code> flag.
                            </p>
                            <hr>
                            <h2 id="procyon"><strong>procyon</strong></h2>
                            <p>
                                <div class="highlight">
                                    <pre tabindex="0"
                                        style="color:#e5e5e5;background-color:#424242;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fallback" data-lang="fallback">procyon -jar "$JARFILE" -o "$OUTDIR"</code></pre>
                                </div>
                            </p>
                            <hr>
                            <div class="pagination">
                                <div class="pagination__buttons">
                                    <span class="button__next">
                                        <a href="/posts/android/android-task-hijacking." target="_blank"
                                            style="text-decoration: none;">
                                            <span class="button-text">← Android Task Hijacking</span>
                                        </a>
                                    </span>

                                    <span class="button__next">
                                        <a href="/posts/android/adb-commands" target="_blank"
                                            style="text-decoration: none;">
                                            <span class="button-text">ADB Commands →</span>
                                        </a>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </header>
                </article>
            </section>
        </div>
        <footer class="footer">
            <section class="container">
                ©2021 - 2022 Waseem Akram · Made with <a href="https://github.com/evildevill/" target="_blank">💖</a>
            </section>
        </footer>
    </main>
    <script src="/js/dark-mode.js"></script>
</body>

</html>